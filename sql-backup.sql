--USE master
--ALTER DATABASE CoursesEdu set single_user WITH ROLLBACK IMMEDIATE
--DROP DATABASE CoursesEdu
 
CREATE DATABASE CoursesEdu
 GO
USE CoursesEdu
 GO

CREATE TABLE Category
(
	CategoryId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	CategoryName NVARCHAR(255) NOT NULL,
	CategorySlug NVARCHAR(255) NOT NULL,
)
GO

CREATE TABLE SubCategory
(
	SubCategoryId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	SubCategoryName NVARCHAR(255) NOT NULL,
	SubCategorySlug NVARCHAR(255) NOT NULL,
)
GO

CREATE TABLE Grade
(
	GradeId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	GradeName NVARCHAR(255) NOT NULL,
	GradeSlug NVARCHAR(255) NOT NULL,
)
GO

CREATE TABLE SchoolSubject
(
	SchoolSubjectId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	SchoolSubjectName NVARCHAR(255),
	SchoolSubjectSlug NVARCHAR(255),
)
GO

CREATE TABLE GradeSubjectDetail
(
	GradeSubjectDetailId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	
	SchoolSubjectId UNIQUEIDENTIFIER REFERENCES SchoolSubject(SchoolSubjectId) ON DELETE CASCADE NOT NULL,
	GradeId UNIQUEIDENTIFIER REFERENCES Grade(GradeId) NOT NULL,
)
GO

CREATE TABLE Courses
(
	CoursesId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	CoursesName NVARCHAR(255) NOT NULL,
	CoursesNameSlug NVARCHAR(255) NOT NULL,
	CoursesContent NVARCHAR(MAX),
	CoursesNumberOfLesson INT,
	CreatedDate DATETIME DEFAULT GETDATE(),

)
GO

CREATE TABLE CoursesDetail
(
	CoursesDetailId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	
	CoursesId UNIQUEIDENTIFIER REFERENCES Courses(CoursesId) ON DELETE CASCADE NOT NULL,
	SchoolSubjectId UNIQUEIDENTIFIER REFERENCES SchoolSubject(SchoolSubjectId) NOT NULL,
	GradeId UNIQUEIDENTIFIER REFERENCES Grade(GradeId) NOT NULL,
)
GO

CREATE TABLE Lesson
(
	LessonId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	LessonName NVARCHAR(255) NOT NULL,
	LessonSlug NVARCHAR(255) NOT NULL,
	LessonContent NVARCHAR(MAX),
	LessonDuration BIGINT,
	CreatedDate DATETIME DEFAULT GETDATE(),

	CoursesId UNIQUEIDENTIFIER REFERENCES Courses(CoursesId) ON DELETE CASCADE NOT NULL,
)
GO

CREATE TABLE Question
(
	QuestionId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	QuestionContent NVARCHAR(MAX) NOT NULL,
	OptionA NVARCHAR(MAX) NOT NULL,
	OptionB NVARCHAR(MAX) NOT NULL,
	OptionC NVARCHAR(MAX) NOT NULL,
	OptionD NVARCHAR(MAX) NOT NULL,
	Answer NVARCHAR(10),

	LessonId UNIQUEIDENTIFIER REFERENCES Lesson(LessonId) ON DELETE CASCADE NOT NULL,
)
GO

CREATE TABLE SystemUser
(
	SystemUserId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	UserFullName NVARCHAR(255) NOT NULL,
	UserName NVARCHAR(255) UNIQUE NOT NULL,
	UserPassword NVARCHAR(255) NOT NULL,
    UserPhone NVARCHAR(20),
    UserEmail NVARCHAR(255),
    UserDob NVARCHAR(255),
    UserAvatar NVARCHAR(255),
)
GO

select * from SystemUser

CREATE TABLE SystemRole
(
	RoleId INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	RoleName NVARCHAR(255),
)
GO

CREATE TABLE UserDetail
(
	UserDetailId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),

	SystemUserId UNIQUEIDENTIFIER NOT NULL,
	SystemRoleId INT NOT NULL,
)
GO

INSERT INTO SystemRole
VALUES
	(N'admin'),
	(N'user')
GO

INSERT INTO SystemUser
(SystemUserId, UserFullName, UserName, UserPassword)
VALUES
	(N'DD114F18-0493-4E35-9BBC-663B8C5E6C61', N'User Test', N'user', N'4297f44b13955235245b2497399d7a93'), -- user - 123123
	(N'8A1B746B-C6F9-4627-B803-271ADB35C289', N'Admin', N'admin', N'21232f297a57a5a743894a0e4a801fc3') --admin - admin
 GO

 INSERT INTO UserDetail
 VALUES
 	(DEFAULT, N'DD114F18-0493-4E35-9BBC-663B8C5E6C61', 2),
 	(DEFAULT, N'8A1B746B-C6F9-4627-B803-271ADB35C289', 1)
 GO

INSERT INTO Grade
VALUES 
(N'76AC2EFC-46B6-4B0F-8E65-C5A38748910A', N'Lớp 10', N'lop-10'),
(N'4B0074B6-D32C-4817-AB69-5B26918C7739', N'Lớp 11', N'lop-11'),
(N'8AE15021-D08C-4463-A0B7-F311587C856E', N'Lớp 12', N'lop-12')
GO

INSERT INTO SchoolSubject
VALUES 
(N'A4E1BC27-8731-42D6-8453-682522A3E9B6', N'Môn Toán', N'mon-toan'),
(N'5B9C856A-75B1-4C41-A37C-5AA275D72E5B', N'Môn Tiếng Việt', N'mon-tieng-viet'),
(N'526BF6C2-3774-4A6D-96A0-3691DA65197F', N'Môn Tiếng Anh', N'mon-tieng-anh'),
(N'11A5A231-8F90-4240-8CFD-21B34E2C1ACD', N'Môn Hóa', N'mon-hoa')
GO

INSERT INTO GradeSubjectDetail
VALUES 
(default, N'526BF6C2-3774-4A6D-96A0-3691DA65197F', N'76AC2EFC-46B6-4B0F-8E65-C5A38748910A'),
(default, N'5B9C856A-75B1-4C41-A37C-5AA275D72E5B', N'76AC2EFC-46B6-4B0F-8E65-C5A38748910A'),
(default, N'A4E1BC27-8731-42D6-8453-682522A3E9B6', N'76AC2EFC-46B6-4B0F-8E65-C5A38748910A'),
(default, N'526BF6C2-3774-4A6D-96A0-3691DA65197F', N'4B0074B6-D32C-4817-AB69-5B26918C7739'),
(default, N'11A5A231-8F90-4240-8CFD-21B34E2C1ACD', N'4B0074B6-D32C-4817-AB69-5B26918C7739')
GO

select * from SchoolSubject, GradeSubjectDetail
WHERE GradeSubjectDetail.SchoolSubjectId = SchoolSubject.SchoolSubjectId
AND GradeSubjectDetail.GradeId = N'4B0074B6-D32C-4817-AB69-5B26918C7739'